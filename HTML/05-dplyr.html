<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-10-07">

<title>Data wrangling dplyr</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="05-dplyr_files/libs/clipboard/clipboard.min.js"></script>
<script src="05-dplyr_files/libs/quarto-html/quarto.js"></script>
<script src="05-dplyr_files/libs/quarto-html/popper.min.js"></script>
<script src="05-dplyr_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="05-dplyr_files/libs/quarto-html/anchor.min.js"></script>
<link href="05-dplyr_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="05-dplyr_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="05-dplyr_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="05-dplyr_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="05-dplyr_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data wrangling dplyr</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 7, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<hr>
<section id="dplyr" class="level1">
<h1><code>dplyr</code></h1>
<p>80% of the work involved with data analysis involves cleaning and shaping the data until it’s in the state you need. Bracket subsetting is handy, but it can be cumbersome and difficult to read, especially for complicated operations. Enter <code>dplyr</code>!</p>
<p><code>dplyr</code> is a package for making data manipulation easier. (It does a lot more too, but this is what we’ll focus on).</p>
<p>Unlike the subsetting commands we’ve already worked on, <code>dplyr</code> is designed to be highly expressive, and highly readable. It’s structured around a set of verbs, or grammar of data manipulation. The core functions we’ll talk about are below:</p>
<ul>
<li><code>select</code></li>
<li><code>arrange</code></li>
<li><code>filter</code></li>
<li><code>group_by</code></li>
<li><code>mutate</code></li>
<li><code>summarise/summarize</code></li>
</ul>
<section id="getting-the-package" class="level2">
<h2 class="anchored" data-anchor-id="getting-the-package">Getting the package</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"dplyr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Again, you may be asked to choose a CRAN mirror; RStudio is a good choice.</p>
<p>Unlike the <code>rmarkdown</code> package, we’ll be using <code>dplyr</code> in the console. In order to do that, we need to <em>load</em> the package into our environment so we can access functions from <code>dplyr</code>. We do this with the <code>library</code> command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"dplyr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You only need to install a package once per computer, but you need to load it every time you open a new R session and want to use that package.</p>
</section>
<section id="read-the-cats-data" class="level2">
<h2 class="anchored" data-anchor-id="read-the-cats-data">Read the cats data</h2>
<p>We read the <code>cats</code> data-set for this lesson. If you have already read it, during the last session, it’s in your environment. If not, please run either of the two following lines of codes in your R console. One is for reading file from your hard-disk the other is for directly reading from the internet.</p>
<section id="from-a-file-saved-in-your-hard-disk" class="level3">
<h3 class="anchored" data-anchor-id="from-a-file-saved-in-your-hard-disk">From a file saved in your hard disk</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## reading from hard-disk</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>cats <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/herding-cats-small.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="from-an-url-hosting-the-dataset" class="level3">
<h3 class="anchored" data-anchor-id="from-an-url-hosting-the-dataset">From an URL hosting the dataset</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>cats <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/AnnArborRUserGroup/AARUG-R-workshop/gh-pages/data/herding-cats-small.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="subsetting-data" class="level2">
<h2 class="anchored" data-anchor-id="subsetting-data">Subsetting Data</h2>
<p>The first two <code>dplyr</code> commands we’ll use help us to subset our data by rows and columns.</p>
<section id="select" class="level3">
<h3 class="anchored" data-anchor-id="select"><code>select</code></h3>
<p>The first command we’ll use is <code>select</code>, which allows us to choose columns from our dataset. Let’s use our <code>cats</code> dataset and select only the <code>coat</code> column; we did this previously with</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>cats[, <span class="st">"coat"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "tabby"   "maltese" "brown"   "black"   "calico"  "tabby"   "brown"  
 [8] "brown"   "black"   "maltese"</code></pre>
</div>
</div>
<p>With dplyr, we don’t need to enclose our column names in quotes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(cats, coat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      coat
1    tabby
2  maltese
3    brown
4    black
5   calico
6    tabby
7    brown
8    brown
9    black
10 maltese</code></pre>
</div>
</div>
<p>Notice how the output differs slightly; all the main <code>dplyr</code> verbs behave consistently in that their inputs and outputs are both <code>data.frame</code>s, rather than returning a simple vector as the bracket-indexing method did. All of the main “verbs” we’ll talk about will return a data.frame as their result.</p>
<p>We can select more columns by giving <code>select</code> additional arguments, and our output <code>data.frame</code> will have columns according to the order of our arguments</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(cats, coat, cat_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      coat cat_id
1    tabby    321
2  maltese    250
3    brown    219
4    black    182
5   calico    107
6    tabby    234
7    brown    196
8    brown    311
9    black    130
10 maltese    349</code></pre>
</div>
</div>
</section>
<section id="filter" class="level3">
<h3 class="anchored" data-anchor-id="filter"><code>filter</code></h3>
<p>So where <code>select</code> allowed us to select <em>columns</em>, <code>filter</code> operated on <em>rows</em>. Say we want to see the all the cats with black coats; we saw earlier how to use that using bracket-indexing:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>cats[cats<span class="sc">$</span>coat <span class="sc">==</span> <span class="st">"black"</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            street  coat    sex   age weight fixed wander_dist roamer cat_id
4    140 Robin Way black female 7.172  8.053     1       0.030     no    182
9 16982 Kennedy Rd black female 2.851  3.291     0       0.065     no    130</code></pre>
</div>
</div>
<p>In dplyr, this looks like</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(cats, coat <span class="sc">==</span> <span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            street  coat    sex   age weight fixed wander_dist roamer cat_id
1    140 Robin Way black female 7.172  8.053     1       0.030     no    182
2 16982 Kennedy Rd black female 2.851  3.291     0       0.065     no    130</code></pre>
</div>
</div>
<p>Notice we don’t have to use the <code>$</code> operator to tell <code>filter</code> where the <code>coat</code> column is; it’s smart enough to assume we want the <code>coat</code> column from the <code>data.frame</code> we passed in.</p>
</section>
<section id="arrange" class="level3">
<h3 class="anchored" data-anchor-id="arrange"><code>arrange</code></h3>
<p>Maybe you have a set of observations in your data that you want to organize by their value. <code>arrange</code> allows us to change the order of rows in our dataset based on their values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(cats, coat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                street    coat    sex   age weight fixed wander_dist roamer
1        140 Robin Way   black female 7.172  8.053     1       0.030     no
2     16982 Kennedy Rd   black female 2.851  3.291     0       0.065     no
3    201 Hollywood Ave   brown female 4.601  3.947     1       0.076     no
4  115 Via Santa Maria   brown   male 6.917  5.626     1       0.097    yes
5      303 Harding Ave   brown   male 3.713  3.982     1       0.033     no
6       135 Charles St  calico   male 4.660  6.193     1       0.085    yes
7      242 Harding Ave maltese female 8.234 12.368     1       0.033     no
8   16528 Marchmont Dr maltese female 4.594  6.994     0       0.059     no
9       Los Robles Way   tabby female 3.003  3.993     0       0.040     no
10 130 Vista Del Campo   tabby female 3.796  3.860     1       0.085     no
   cat_id
1     182
2     130
3     219
4     196
5     311
6     107
7     250
8     349
9     321
10    234</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># you can include additional columns to help sort the data</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(cats, coat, sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                street    coat    sex   age weight fixed wander_dist roamer
1        140 Robin Way   black female 7.172  8.053     1       0.030     no
2     16982 Kennedy Rd   black female 2.851  3.291     0       0.065     no
3    201 Hollywood Ave   brown female 4.601  3.947     1       0.076     no
4  115 Via Santa Maria   brown   male 6.917  5.626     1       0.097    yes
5      303 Harding Ave   brown   male 3.713  3.982     1       0.033     no
6       135 Charles St  calico   male 4.660  6.193     1       0.085    yes
7      242 Harding Ave maltese female 8.234 12.368     1       0.033     no
8   16528 Marchmont Dr maltese female 4.594  6.994     0       0.059     no
9       Los Robles Way   tabby female 3.003  3.993     0       0.040     no
10 130 Vista Del Campo   tabby female 3.796  3.860     1       0.085     no
   cat_id
1     182
2     130
3     219
4     196
5     311
6     107
7     250
8     349
9     321
10    234</code></pre>
</div>
</div>
</section>
<section id="mutate" class="level3">
<h3 class="anchored" data-anchor-id="mutate"><code>mutate</code></h3>
<p>One common task in working with data is updating/cleaning some of the values in columns. <code>mutate</code> allows us to do this relatively easily. Let’s say I don’t want a lot of decimal places in one of my measurements. I can use <code>mutate</code> to update my existing variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(cats, <span class="at">weight =</span> <span class="fu">round</span>(weight, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                street    coat    sex   age weight fixed wander_dist roamer
1       Los Robles Way   tabby female 3.003   3.99     0       0.040     no
2      242 Harding Ave maltese female 8.234  12.37     1       0.033     no
3    201 Hollywood Ave   brown female 4.601   3.95     1       0.076     no
4        140 Robin Way   black female 7.172   8.05     1       0.030     no
5       135 Charles St  calico   male 4.660   6.19     1       0.085    yes
6  130 Vista Del Campo   tabby female 3.796   3.86     1       0.085     no
7  115 Via Santa Maria   brown   male 6.917   5.63     1       0.097    yes
8      303 Harding Ave   brown   male 3.713   3.98     1       0.033     no
9     16982 Kennedy Rd   black female 2.851   3.29     0       0.065     no
10  16528 Marchmont Dr maltese female 4.594   6.99     0       0.059     no
   cat_id
1     321
2     250
3     219
4     182
5     107
6     234
7     196
8     311
9     130
10    349</code></pre>
</div>
</div>
<p>Another common task is generating a new column based on values that are already in the dataset you are working on. <code>mutate</code> helps us do this, and tacks a new column to the end of our data.frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let's say you want to add two variables together</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(cats, <span class="at">new_variable =</span> age <span class="sc">+</span> weight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                street    coat    sex   age weight fixed wander_dist roamer
1       Los Robles Way   tabby female 3.003  3.993     0       0.040     no
2      242 Harding Ave maltese female 8.234 12.368     1       0.033     no
3    201 Hollywood Ave   brown female 4.601  3.947     1       0.076     no
4        140 Robin Way   black female 7.172  8.053     1       0.030     no
5       135 Charles St  calico   male 4.660  6.193     1       0.085    yes
6  130 Vista Del Campo   tabby female 3.796  3.860     1       0.085     no
7  115 Via Santa Maria   brown   male 6.917  5.626     1       0.097    yes
8      303 Harding Ave   brown   male 3.713  3.982     1       0.033     no
9     16982 Kennedy Rd   black female 2.851  3.291     0       0.065     no
10  16528 Marchmont Dr maltese female 4.594  6.994     0       0.059     no
   cat_id new_variable
1     321        6.996
2     250       20.602
3     219        8.548
4     182       15.225
5     107       10.853
6     234        7.656
7     196       12.543
8     311        7.695
9     130        6.142
10    349       11.588</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># you can include as many new variables as you want, separated by a comma</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(cats, <span class="at">new_var_1 =</span> age <span class="sc">+</span> weight, <span class="at">new_var_2 =</span> age <span class="sc">*</span> weight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                street    coat    sex   age weight fixed wander_dist roamer
1       Los Robles Way   tabby female 3.003  3.993     0       0.040     no
2      242 Harding Ave maltese female 8.234 12.368     1       0.033     no
3    201 Hollywood Ave   brown female 4.601  3.947     1       0.076     no
4        140 Robin Way   black female 7.172  8.053     1       0.030     no
5       135 Charles St  calico   male 4.660  6.193     1       0.085    yes
6  130 Vista Del Campo   tabby female 3.796  3.860     1       0.085     no
7  115 Via Santa Maria   brown   male 6.917  5.626     1       0.097    yes
8      303 Harding Ave   brown   male 3.713  3.982     1       0.033     no
9     16982 Kennedy Rd   black female 2.851  3.291     0       0.065     no
10  16528 Marchmont Dr maltese female 4.594  6.994     0       0.059     no
   cat_id new_var_1  new_var_2
1     321     6.996  11.990979
2     250    20.602 101.838112
3     219     8.548  18.160147
4     182    15.225  57.756116
5     107    10.853  28.859380
6     234     7.656  14.652560
7     196    12.543  38.915042
8     311     7.695  14.785166
9     130     6.142   9.382641
10    349    11.588  32.130436</code></pre>
</div>
</div>
</section>
</section>
<section id="pipes" class="level2">
<h2 class="anchored" data-anchor-id="pipes">Pipes</h2>
<p>You’ll often find yourself needing to use multiple functions in a row to organize some data that you’re working on. This can sometimes lead to dense code that is difficult to read.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for example</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">round</span>(<span class="fu">sqrt</span>(cats<span class="sc">$</span>age <span class="sc">*</span> <span class="dv">2</span>), <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 2.388 2.451 2.725 2.755 3.031 3.033 3.053 3.719 3.787 4.058</code></pre>
</div>
</div>
<p>In the code above, I have multiple steps to get my result, but you have to read what’s going on from the inside out. This can be cumbersome, especially if you need to understand how one function’s output influences the next operation.</p>
<section id="using-pipes" class="level3">
<h3 class="anchored" data-anchor-id="using-pipes">Using Pipes</h3>
<p><code>dplyr</code> includes a special operator designed to make code <em>flow</em> and appear more readable.</p>
<p>It’s written as <code>%&gt;%</code>, and you can call it the “pipe” operator.</p>
<p>Our example above can be re-written as:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>cats<span class="sc">$</span>age <span class="sc">*</span> <span class="dv">2</span> <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  4.246242 11.642876  6.505814 10.141208  6.589240  5.367544  9.780638
 [8]  5.250182  4.031314  6.495916</code></pre>
</div>
</div>
<p>Instead of being nested within a bunch of commands, you can see read the code as a series of statements: 1. Multiply <code>cats$age</code> by 2, <em>then</em> 2. Take the square-root of these values, <em>then</em> 3. Round the result to the 3rd digit, <em>then</em> 4. Sort the values in ascending order</p>
<p>I encourage you to think of the <code>%&gt;%</code> as short-hand for “then”, when reading code that uses it!</p>
<p>“Pipe” operators are found in other languages; they get their name from the idea that your code can be thought of as a “pipeline”.</p>
<p>Let’s look at another example.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fl">1.23456789</span>, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.235</code></pre>
</div>
</div>
<p>We can use a pipe operator to acheive the same thing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fl">1.23456789</span> <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.235</code></pre>
</div>
</div>
<p>The pipe takes care of making sure the output of the expression on the left-hand-side (a simple numeric, in this case) is inserted as the first argument of the expressing on the right-hand-side. We can also pipe into other argument positions by using a period as a placeholder.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="fl">1.23456789</span>, .)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.235</code></pre>
</div>
</div>
<p>These are contrived examples, and I don’t suggest using pipes for simple operations like rounding. The pipes really become useful when chaining together multiple operations in sequence, as we’ll do with our <code>dplyr</code> functions.</p>
</section>
</section>
<section id="combining-select-filter" class="level2">
<h2 class="anchored" data-anchor-id="combining-select-filter">Combining Select &amp; Filter</h2>
<p>The pipe is really helpful when combined with the data-manipulation of <code>dplyr</code>. Remember how we used <code>filter</code> to select only the black cats? What if we only want to see the ID’s of those cats, rather than all the info about them? We’ve already seen we can use <code>select</code> to pick out certain columns. We can use that to select the <code>cat_id</code> column from our <code>filter</code>ed dataset like so</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reading from the inside out</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(<span class="fu">filter</span>(cats, coat <span class="sc">==</span> <span class="st">"black"</span>), cat_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  cat_id
1    182
2    130</code></pre>
</div>
</div>
<p>That might not look too bad now, but what if we wanted to do another operation on that output? We’d add another layer of nesting, and having to read that line from the inside-out can quickly become annoying. We can use the pipe operator to clean that up.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reading from left to right</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(cats, coat <span class="sc">==</span> <span class="st">"black"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(cat_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  cat_id
1    182
2    130</code></pre>
</div>
</div>
<p>We could even add another pipe to feed <code>cats</code> into <code>filter</code>; it isn’t necessary, but it makes it even easier to see what we’re operating on in this chain of commands. We’ll combine this with some line breaks to really make this easy to read:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>cats <span class="sc">%&gt;%</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(coat <span class="sc">==</span> <span class="st">"black"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cat_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  cat_id
1    182
2    130</code></pre>
</div>
</div>
<section id="summarize" class="level3">
<h3 class="anchored" data-anchor-id="summarize"><code>summarize</code></h3>
<p>While <code>mutate</code> creates new columns, it’s often useful to summarize multiple rows into a single value. Say we want to find the mean weight of all these cats; enter <code>summarize</code>! Like <code>mutate</code>, the arguments to summarize (after the <code>data.frame</code> we want to operate on) are expressions. We can combine <code>summarize</code> with the <code>mean</code> function to get a mean weight for our collection of cats like so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>cats <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">mean_weight =</span> <span class="fu">mean</span>(weight))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  mean_weight
1      5.8307</code></pre>
</div>
</div>
<p>Notice how we have only a single value returned, but it’s still in a <code>data.frame</code> format. This is subtle, but important; all these basic <code>dplyr</code> verbs take in <code>data.frame</code>s and also return <code>data.frame</code>s. This consistency helps make long chains of <code>dplyr</code> operations possible.</p>
</section>
<section id="group_by" class="level3">
<h3 class="anchored" data-anchor-id="group_by"><code>group_by</code></h3>
<p>A very common data analysis task is to do operations like we did above, but to do them on a group-by-group basis. To do this with <code>dplyr</code>, we’ll use the <code>group_by</code> function.</p>
<p>Let’s look at the mean weights of our cats, grouping up by coat. This will give us the mean weight of the black cats, mean weight of the calico cats, etc. We can do this by inserting a <code>group_by</code> function into our earlier expression for computing mean weight:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>cats <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(coat) <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_weight =</span> <span class="fu">mean</span>(weight))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  coat    mean_weight
  &lt;chr&gt;         &lt;dbl&gt;
1 black          5.67
2 brown          4.52
3 calico         6.19
4 maltese        9.68
5 tabby          3.93</code></pre>
</div>
</div>
<p>Ta-da!</p>
<p>We can also use <code>mutate</code> on a per-group basis. Let’s make a new column which centers our weights around zero; this can be done by subtracting the group’s mean weight from each cat’s weight:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>cats <span class="sc">%&gt;%</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(coat) <span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">centered_weight =</span> weight <span class="sc">-</span> <span class="fu">mean</span>(weight))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 10
# Groups:   coat [5]
   street           coat  sex     age weight fixed wande…¹ roamer cat_id cente…²
   &lt;chr&gt;            &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;int&gt;   &lt;dbl&gt;
 1 Los Robles Way   tabby fema…  3.00   3.99     0   0.04  no        321  0.0665
 2 242 Harding Ave  malt… fema…  8.23  12.4      1   0.033 no        250  2.69  
 3 201 Hollywood A… brown fema…  4.60   3.95     1   0.076 no        219 -0.571 
 4 140 Robin Way    black fema…  7.17   8.05     1   0.03  no        182  2.38  
 5 135 Charles St   cali… male   4.66   6.19     1   0.085 yes       107  0     
 6 130 Vista Del C… tabby fema…  3.80   3.86     1   0.085 no        234 -0.0665
 7 115 Via Santa M… brown male   6.92   5.63     1   0.097 yes       196  1.11  
 8 303 Harding Ave  brown male   3.71   3.98     1   0.033 no        311 -0.536 
 9 16982 Kennedy Rd black fema…  2.85   3.29     0   0.065 no        130 -2.38  
10 16528 Marchmont… malt… fema…  4.59   6.99     0   0.059 no        349 -2.69  
# … with abbreviated variable names ¹​wander_dist, ²​centered_weight</code></pre>
</div>
</div>
<blockquote class="blockquote">
<h3 id="challenge" class="anchored">Challenge</h3>
<ol type="1">
<li>Read the American Community Survey Data (2012) from <a href="https://www.openintro.org/data/index.php?data=acs12">https://www.openintro.org/data/index.php?data=acs12</a>. Use the <code>read.csv</code> function taught before. 2. Look at the structure of the data-set by using the <code>str</code> function.</li>
<li>Calculate the mean annual income (<code>income</code>) by gender (<code>gender</code>) and birth quarter (<code>birth_qrtr</code>).</li>
<li>What other variables could be of interest?</li>
</ol>
</blockquote>
<div class="cell">
<details>
<summary>expand for full code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>acs <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://www.openintro.org/data/csv/acs12.csv"</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(acs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  income         employment hrs_work  race age gender citizen time_to_work
1  60000 not in labor force       40 white  68 female     yes           NA
2      0 not in labor force       NA white  88   male     yes           NA
3     NA               &lt;NA&gt;       NA white  12 female     yes           NA
4      0 not in labor force       NA white  17   male     yes           NA
5      0 not in labor force       NA white  77 female     yes           NA
6   1700           employed       40 other  35 female     yes           15
     lang married         edu disability   birth_qrtr
1 english      no     college         no jul thru sep
2 english      no hs or lower        yes jan thru mar
3 english      no hs or lower         no oct thru dec
4   other      no hs or lower         no oct thru dec
5   other      no hs or lower        yes jul thru sep
6   other     yes hs or lower        yes jul thru sep</code></pre>
</div>
<details>
<summary>expand for full code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>acs <span class="sc">%&gt;%</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(birth_qrtr) <span class="sc">%&gt;%</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_income =</span> <span class="fu">mean</span>(income, <span class="at">na.rm =</span> T))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  birth_qrtr   mean_income
  &lt;chr&gt;              &lt;dbl&gt;
1 apr thru jun      22576.
2 jan thru mar      26095.
3 jul thru sep      25950.
4 oct thru dec      19917.</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="going-further" class="level1">
<h1>Going further</h1>
<p>This is an introductory look at <code>dplyr</code>, just enough to make you dangerous. As you continue your R journey I suggest looking into the other awesome things you can do with this package!</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>